# justfile for b00t-mcp NPM package management
# ğŸ“¦ Cross-platform binary distribution via npm/npx

repo-root := env_var_or_default("JUST_REPO_ROOT", `git rev-parse --show-toplevel 2>/dev/null || echo ..`)

set shell := ["bash", "-cu"]

# ğŸ”¨ Build cross-platform binaries
build:
    #!/bin/bash
    echo "ğŸ”¨ Building b00t-mcp for npm distribution..."
    node scripts/build.js

# ğŸ§ª Test npm package structure
test:
    #!/bin/bash
    echo "ğŸ§ª Testing b00t-mcp npm package..."
    node scripts/test.js

# ğŸ“¦ Create npm package tarball
pack:
    #!/bin/bash
    echo "ğŸ“¦ Creating npm package..."
    npm pack

# ğŸš€ Publish to npm registry
publish:
    #!/bin/bash
    echo "ğŸš€ Publishing b00t-mcp to npm..."
    npm publish

# ğŸ§ª Test installation process
install-test:
    #!/bin/bash
    echo "ğŸ§ª Testing npm installation..."
    cd /tmp
    npm install -g {{repo-root}}/b00t-mcp-npm
    which b00t-mcp
    b00t-mcp --version || echo "Version check failed but binary found"

# ğŸ§¹ Clean build artifacts
clean:
    #!/bin/bash
    echo "ğŸ§¹ Cleaning npm build artifacts..."
    rm -rf dist/ *.tgz node_modules/
    
# ğŸ“‹ Show package info
info:
    #!/bin/bash
    echo "ğŸ“‹ b00t-mcp npm package info:"
    echo "Version: $(jq -r .version package.json)"
    echo "Files:"
    npm pack --dry-run

# ğŸ” Validate package before publish
validate: test pack
    #!/bin/bash
    echo "âœ… Package validation complete"

# ğŸ¯ Full build and test workflow
ci: build test pack
    #!/bin/bash
    echo "ğŸ¯ CI workflow complete"